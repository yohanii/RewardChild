## ðŸ§© ì „ì²´ êµ¬ì¡° ìš”ì•½

```sql
users (1)
    â”œâ”€â”€< relations (N)
    â”‚     â””â”€â”€< quests (N)
    â”‚
    â”œâ”€â”€< shop_purchases (N) >â”€â”€â”€(1) shop_items
    â”‚
    â”œâ”€â”€< bank_purchases (N) >â”€â”€â”€(1) bank_items
    â”‚
    â”œâ”€â”€1â”€ balances
    â”‚
    â””â”€â”€< transactions (N)
        â””â”€â”€ (ref: quests / shop_purchases / bank_purchases)
```

## 1. users

```sql
users (
    user_id BIGINT PRIMARY KEY,
    nickname VARCHAR,
    tag VARCHAR UNIQUE,   -- ê°™ì€ ë‹‰ë„¤ìž„ ë‚´ì—ì„œ ì¤‘ë³µ ë°©ì§€
    kakao_id VARCHAR UNIQUE,
    role ENUM('PARENT', 'CHILD'),
    created_at TIMESTAMP,
    updated_at TIMESTAMP
)
```

**ì¶”ê°€ ê³ ë ¤**

- `tag` ìƒì„± ì‹œ `nickname` ê¸°ì¤€ìœ¼ë¡œ ëžœë¤ 16ì§„ìˆ˜ 4ìžë¦¬ â†’ Supabase í•¨ìˆ˜ ë˜ëŠ” ë°±ì—”ë“œ ë¡œì§ì—ì„œ ì²˜ë¦¬.
- `profile_image_url` ì •ë„ëŠ” ì¶”í›„ UI ê°œì„ ì— ëŒ€ë¹„í•´ ë¯¸ë¦¬ ë„£ì–´ë„ ì¢‹ì•„.

## 2. relations

```sql
relations (
    relation_id BIGINT PRIMARY KEY,
    parent_id BIGINT REFERENCES users(user_id),
    child_id BIGINT REFERENCES users(user_id),
    status ENUM('PENDING', 'ACTIVE', 'BLOCKED') DEFAULT 'ACTIVE',
    created_at TIMESTAMP
)
```

## 3. quests

```sql
quests (
    quest_id BIGINT PRIMARY KEY,
    relation_id BIGINT REFERENCES relations(relation_id),
    parent_id BIGINT REFERENCES users(user_id),
    child_id BIGINT REFERENCES users(user_id),
    title VARCHAR,
    content TEXT,
    reward INT,  -- ìž¬í™” ë‹¨ìœ„
    status ENUM('REGISTERED', 'REQUESTED', 'COMPLETED') DEFAULT 'REGISTERED',
    created_at TIMESTAMP,
    updated_at TIMESTAMP,
    completed_at TIMESTAMP NULL
)
```

## 4. shop_items & shop_purchases

shop_items : ëª¨í—˜ê°€ê°€ ëª¨ì€ ìž¬í™”ë¡œ ë³´ìƒ êµ¬ë§¤í•˜ëŠ” ê³³ ë³´ìƒ ëª©ë¡, ìƒì ì£¼ì¸ì´ ë“±ë¡í•œ ë³´ìƒ ëª©ë¡

purchases : êµ¬ë§¤í•œ ì•„ì´í…œ ë‚´ì—­

```sql
shop_items (
    shop_item_id BIGINT PRIMARY KEY,
    title VARCHAR,
    content TEXT,
    price INT,
    category VARCHAR NULL,
    image_url VARCHAR NULL
)

shop_purchases (
    purchase_id BIGINT PRIMARY KEY,
    user_id BIGINT REFERENCES users(user_id),
    shop_item_id BIGINT REFERENCES shop_items(shop_item_id),
    purchased_at TIMESTAMP
)

```

## 5.  bank_items & bank_purchases

bank_items : ë¶€ëª¨ë‹˜ì´ ê²°ì œí•  ìˆ˜ ìžˆëŠ” ëª©ë¡

bank_purchases : ì€í–‰ì—ì„œ êµ¬ë§¤í•œ ë‚´ì—­

- ê²°ì œ ìˆ˜ë‹¨ì´ ì¶”ê°€ë  ìˆ˜ ìžˆìœ¼ë‹ˆ `currency`, `payment_method` ë“± í™•ìž¥ì„± ê³ ë ¤.

```sql
bank_items (
    bank_item_id BIGINT PRIMARY KEY,
    title VARCHAR,
    content TEXT,
    price INT
)

bank_purchases (
    purchase_id BIGINT PRIMARY KEY,
    parent_id BIGINT REFERENCES users(user_id),
    bank_item_id BIGINT REFERENCES bank_items(bank_item_id),
    amount INT,
    purchased_at TIMESTAMP
)
```

## 6.  balances & transactions

ë¶€ëª¨ê°€ êµ¬ë§¤í•˜ê±°ë‚˜, ìžë…€ê°€ í€˜ìŠ¤íŠ¸ ë³´ìƒìœ¼ë¡œ ë°›ëŠ” ìž¬í™”ë¥¼ ì¶”ì í•˜ë ¤ë©´

ë³„ë„ì˜ **â€œìž¬í™” íë¦„â€ í…Œì´ë¸”**ì´ ìžˆì–´ì•¼ í•¨.

balances : í˜„ìž¬ ìž”ì•¡ ì¶”ì 

transactions : ìž¬í™” ì´ë™ ì¶”ì 

```sql
balances (
    balance_id BIGINT PRIMARY KEY,
    user_id BIGINT REFERENCES users(user_id),
    amount INT, -- í˜„ìž¬ ìž”ì•¡
    updated_at TIMESTAMP
)

transactions (
    transaction_id BIGINT PRIMARY KEY,
    user_id BIGINT REFERENCES users(user_id),
    type ENUM('QUEST_REWARD', 'SHOP_PURCHASE', 'BANK_PURCHASE'),
    amount INT,
    created_at TIMESTAMP,
    reference_id BIGINT NULL  -- ê´€ë ¨ quest_idë‚˜ purchase_id
)
```

- ìžë…€ê°€ í€˜ìŠ¤íŠ¸ ì™„ë£Œ â†’ `transactions`ì— ê¸°ë¡ + `balances` ì—…ë°ì´íŠ¸
- ë¶€ëª¨ê°€ í˜„ê¸ˆ ì¶©ì „ â†’ `transactions`ì— ê¸°ë¡ + `balances` ì—…ë°ì´íŠ¸
- ìƒì  êµ¬ë§¤ â†’ `transactions`ì— ê¸°ë¡ + `balances` ì°¨ê°